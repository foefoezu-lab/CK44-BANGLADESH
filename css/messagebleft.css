// messagebleft.js
// Versi stabil anti-freeze

// Data pemenang (edit sesuka hati)
const winnerFeed = [
  {
    player: "Shafin***48",
    game: "Mega Moolah",
    amount: "৳9,694 BDT",
    note: "menang besar di Bangladesh!"
  },
  {
    player: "Arif***16",
    game: "Big Bass Bonanza",
    amount: "৳10,284 BDT",
    note: "menang besar di Bangladesh!"
  },
  {
    player: "Nadia***33",
    game: "Sugar Rush",
    amount: "৳19,410 BDT",
    note: "payout cepat & aman!"
  },
  {
    player: "Rohan***72",
    game: "Wild West Gold",
    amount: "৳14,216 BDT",
    note: "WD sukses 24/7!"
  },
  {
    player: "Amin***44",
    game: "Gates of Olympus",
    amount: "৳11,880 BDT",
    note: "bonus aktif VIP 30!"
  }
];

// Konfigurasi
const SHOW_INTERVAL = 5000;   // satu kartu baru tiap 5 detik
const MAX_ACTIVE_CARDS = 3;   // biar ga numpuk ratusan
let feedIndex = 0;

// Cari container di halaman. Kedua file HTML kamu punya ini:
// <div class="message-left-container"></div>
let wrap = document.querySelector(".message-left-container");

// fallback: kalau belum ada container (misal ada halaman lain), bikin
if (!wrap) {
  wrap = document.createElement("div");
  wrap.className = "message-left-container";
  wrap.setAttribute(
    "style",
    [
      "position:fixed",
      "left:16px",
      "bottom:16px",
      "z-index:9999",
      "display:flex",
      "flex-direction:column",
      "gap:8px",
      "pointer-events:none",
      "font-family:system-ui,-apple-system,BlinkMacSystemFont,'Inter','Segoe UI',Roboto,Helvetica,Arial,sans-serif"
    ].join(";")
  );
  document.body.appendChild(wrap);
}

// bikin kartu popup hijau
function createCard(dataObj) {
  const card = document.createElement("div");

  // style kartu hijau glow langsung inline
  card.setAttribute(
    "style",
    [
      "min-width:240px",
      "max-width:260px",
      "border-radius:12px",
      "background:radial-gradient(circle at 15% 15%, rgba(0,80,40,.55) 0%, rgba(0,20,10,.9) 60%)",
      "border:1px solid rgba(0,255,128,.35)",
      "box-shadow:0 20px 40px rgba(0,0,0,.9),0 0 20px rgba(0,255,128,.25),0 0 60px rgba(0,255,128,.15)",
      "padding:12px 14px",
      "color:#fff",
      "font-size:.7rem",
      "line-height:1.4",
      "font-weight:500",
      "pointer-events:auto",
      "opacity:0",
      "transform:translateY(20px) scale(.96)",
      "transition:all .3s ease",
      "background-clip:padding-box"
    ].join(";")
  );

  // isi teks popup
  card.innerHTML = `
    <div style="
      font-size:.7rem;
      line-height:1.4;
      font-weight:600;
      color:#00ff6a;
      text-shadow:0 0 8px rgba(0,255,128,.8),0 0 16px rgba(0,255,128,.4);
      margin-bottom:4px;
    ">
      ${dataObj.player} ${dataObj.note}
    </div>

    <div style="color:#fff;font-size:.7rem;line-height:1.4;">
      Game: ${dataObj.game}
    </div>

    <div style="
      color:#00ff6a;
      font-weight:700;
      font-size:.75rem;
      line-height:1.3;
      margin-top:4px;
      text-shadow:0 0 8px rgba(0,255,128,.8),0 0 16px rgba(0,255,128,.4);
    ">
      ${dataObj.amount}
    </div>
  `;

  // animasi masuk
  requestAnimationFrame(() => {
    card.style.opacity = "1";
    card.style.transform = "translateY(0) scale(1)";
  });

  return card;
}

// masukin satu kartu popup
function pushCard() {
  const dataObj = winnerFeed[feedIndex % winnerFeed.length];
  feedIndex++;

  const card = createCard(dataObj);
  wrap.appendChild(card);

  // cek jumlah kartu aktif
  const cards = wrap.children;
  if (cards.length > MAX_ACTIVE_CARDS) {
    const first = cards[0];
    // animasi keluar halus
    first.style.opacity = "0";
    first.style.transform = "translateY(20px) scale(.96)";
    first.style.transition = "all .3s ease";

    setTimeout(() => {
      if (first && first.parentNode) {
        first.parentNode.removeChild(first);
      }
    }, 300);
  }
}

// start loop aman
function startFeed() {
  pushCard(); // tampilkan 1 pertama
  setInterval(pushCard, SHOW_INTERVAL); // lalu tiap 5 detik
}

// jalanin setelah DOM siap
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", startFeed);
} else {
  startFeed();
}
